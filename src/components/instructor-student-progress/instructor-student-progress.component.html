<div class="p-6 space-y-6">
  <header>
    <h2 class="text-2xl font-bold text-white">Student Progress</h2>
    <p class="text-slate-400 mt-1">Track and monitor the performance of all students.</p>
  </header>

  <div class="bg-slate-800/50 backdrop-blur-lg border border-slate-700 rounded-lg p-4">
    <div class="flex justify-end mb-4">
      <div class="relative">
        <input 
          type="text" 
          placeholder="Search students..."
          class="bg-slate-900/50 border border-slate-600 rounded-md pl-10 pr-4 py-2 text-white placeholder-slate-400 focus:ring-emerald-500 focus:border-emerald-500"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    </div>
    
    <div class="overflow-x-auto">
        <table class="w-full text-left">
            <thead class="border-b border-slate-600">
                <tr>
                    <th class="p-4 text-sm font-semibold text-slate-400 cursor-pointer" (click)="sortBy('name')">
                      Name
                      @if (sortKey() === 'name') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
                    </th>
                    <th class="p-4 text-sm font-semibold text-slate-400 cursor-pointer" (click)="sortBy('batch')">
                      Batch
                      @if (sortKey() === 'batch') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
                    </th>
                    <th class="p-4 text-sm font-semibold text-slate-400 cursor-pointer" (click)="sortBy('progress')">
                      Progress
                      @if (sortKey() === 'progress') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
                    </th>
                    <th class="p-4 text-sm font-semibold text-slate-400 cursor-pointer" (click)="sortBy('assignmentsCompleted')">
                      Assignments
                    </th>
                    <th class="p-4 text-sm font-semibold text-slate-400 cursor-pointer" (click)="sortBy('attendance')">
                      Attendance
                      @if (sortKey() === 'attendance') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
                    </th>
                </tr>
            </thead>
            <tbody>
                @for (student of filteredAndSortedStudents(); track student.name) {
                    <tr class="border-b border-slate-700 last:border-0 hover:bg-slate-700/50">
                        <td class="p-4 font-medium">
                          <button (click)="viewStudentDetails(student)" class="text-emerald-400 hover:text-emerald-300 text-left">
                            {{ student.name }}
                          </button>
                        </td>
                        <td class="p-4 text-slate-300">{{ student.batch }}</td>
                        <td class="p-4">
                          <div class="flex items-center gap-2">
                            <div class="w-full bg-slate-700 rounded-full h-2.5">
                              <div class="bg-emerald-500 h-2.5 rounded-full" [style.width.%]="student.progress"></div>
                            </div>
                            <span class="text-sm font-semibold text-white">{{ student.progress }}%</span>
                          </div>
                        </td>
                        <td class="p-4 text-slate-300">{{ student.assignmentsCompleted }} / {{ student.totalAssignments }}</td>
                        <td class="p-4 text-white font-semibold">{{ student.attendance }}</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
  </div>
</div>

@if(selectedStudent(); as student) {
  <app-instructor-student-detail [student]="student" (close)="closeStudentDetails()"></app-instructor-student-detail>
}
